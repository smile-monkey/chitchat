'use strict';agGrid.initialiseAgGridWithAngular1(angular);angular.module('chitchat',['ui.router','ngAnimate','agGrid','ui.bootstrap','angular-simple-chat','darthwade.dwLoading','ngStorage']).config(["$stateProvider","$urlRouterProvider","$qProvider",function($stateProvider,$urlRouterProvider,$qProvider){$qProvider.errorOnUnhandledRejections(!1);$urlRouterProvider.when('/dashboard','/dashboard/photos');$urlRouterProvider.otherwise('/login');$stateProvider.state('base',{abstract:!0,url:'',templateUrl:'views/base.html'}).state('login',{url:'/login',parent:'base',templateUrl:'views/login.html',controller:'LoginCtrl'}).state('dashboard',{url:'/dashboard',parent:'base',templateUrl:'views/dashboard.html',controller:'DashboardCtrl'}).state('photos',{url:'/photos',parent:'dashboard',templateUrl:'views/dashboard/photos.html',controller:'PhotosCtrl',})}]).run(["$rootScope","$loading","$localStorage","$location",function($rootScope,$loading,$localStorage,$location){$rootScope.startLoading=function(name){$loading.start(name)};$rootScope.finishLoading=function(name){$loading.finish(name)};$rootScope.logout=function(){$localStorage.$reset();$location.path('/login')};$rootScope.chkImagefile=function(filename){var valid_ext=['png','jpg','jpeg','gif','ico','bmp']
var ext=filename.split('.').pop().toLowerCase();return(valid_ext.indexOf(ext)<0)?!1:!0}}]);'use strict';angular.module('chitchat').controller('LoginCtrl',["$scope","$rootScope","$location","$localStorage","$http","Config",function($scope,$rootScope,$location,$localStorage,$http,Config){$scope.user={};$scope.submit=function(isvalid){$rootScope.startLoading('loadingLogin');if(isvalid){var jsonurl=Config.api.url+"/base/login";var sdata={access_token:Config.api.access_token,auth_email:$scope.user.login,auth_pass:$scope.user.pass};$http({method:"POST",url:jsonurl,cache:!1,data:sdata,timeout:15000}).then(function(result){if(result.data.status=="ok"){$localStorage.session=$scope.user;$localStorage.session.user_id=result.data.user_id;$location.path('/dashboard')}else{alert('Invalid Username and Password')}
$rootScope.finishLoading('loadingLogin')},function(error){alert('Invalid Username and Password');$rootScope.finishLoading('loadingLogin')})}else{$rootScope.finishLoading('loadingLogin')}
return!1}}]);'use strict';angular.module('chitchat').controller('DashboardCtrl',["$scope","$state","$location","$rootScope","$localStorage",function($scope,$state,$location,$rootScope,$localStorage){$scope.$state=$state;$scope.username=$localStorage.session.login;$scope.logout=function(){$rootScope.logout()}}]);'use strict';angular.module('chitchat').controller('PhotosCtrl',["$scope","$rootScope","$state","$uibModal","$filter","$localStorage","Config","$http","$httpParamSerializer",function($scope,$rootScope,$state,$uibModal,$filter,$localStorage,Config,$http,$httpParamSerializer){var story_formdata=new FormData();$scope.init=function(){$scope.story={story_sender_id:"",story_receiver_id:"",story_type:'0',story_text:"",story_unlock_coins:"",story_reply_coins:"",story_main_url:"",story_original_userid:"",story_target_storyid:0};$scope.gridOptions={rowData:null,enableColResize:!0,enableFilter:!0,rowHeight:40,rowSelection:'multiple',suppressRowClickSelection:!0,columnDefs:[{headerName:'Story ID',field:'story_id',width:80,filter:'text',filterParams:{apply:!0}},{headerName:'Story Sender ID',field:'story_sender_id',width:120,filter:'text',filterParams:{apply:!0}},{headerName:'Story Receiver ID',field:'story_receiver_id',width:150,filter:'text',filterParams:{apply:!0}},{headerName:'Story Type',field:'story_type',width:100,filter:'text',filterParams:{apply:!0}},{headerName:'Story Text',field:'story_text',width:200,filter:'text',filterParams:{apply:!0}},{headerName:'Story Unlock Coins',field:'story_unlock_coins',width:150,filter:'text',filterParams:{apply:!0}},{headerName:'Story Reply Coins',field:'story_reply_coins',width:150,filter:'text',filterParams:{apply:!0}},{headerName:'Story Main Url',field:'story_main_url',filter:'text',filterParams:{apply:!0}}],};$scope.getAllStories()};$scope.onFilterChanged=function(value){$scope.filterText=value;$scope.gridOptions.api.setQuickFilter(value)};$scope.getAllStories=function(){var url=Config.api.url+"/base/getAllStories";$http.post(url,{access_token:Config.api.access_token}).then(function(res){$scope.storyPhotos=res.data.values;if($scope.gridOptions.api!==null){$scope.gridOptions.api.setRowData($scope.storyPhotos)}},function(err){alert("Failed to connect server(get).");$scope.storyPhotos=[];$scope.gridOptions.api.setRowData($scope.storyPhotos)})};$scope.openModal=function(page,size){$scope.modal=$uibModal.open({animation:!0,templateUrl:page,size:size,scope:$scope,backdrop:'static',resolve:{items:function(){return $scope.items}}})};$scope.closeModal=function(){$scope.modal.close()};$scope.showAddPhoto=function(){$scope.openModal('views/modal/addphoto.html','lg')};$scope.prepareUpload=function($files){$("#upload-file-info").html($files[0].name);story_formdata.append("story_main",$files[0])};$scope.submit=function(){$rootScope.startLoading('AddingPhoto');var story_params=$httpParamSerializer($scope.story);var posturl=Config.api.url+"/base/?action=addStory&"+story_params+"&access_token="+Config.api.access_token;var request={method:'POST',url:posturl,data:story_formdata,headers:{'Content-Type':undefined}};console.log(request);$http(request).then(function successCallback(res){console.log(res);$rootScope.finishLoading('AddingPhoto');$scope.story={story_sender_id:"",story_receiver_id:"",story_type:'0',story_text:"",story_unlock_coins:"",story_reply_coins:"",story_main_url:"",story_original_userid:"",story_target_storyid:0};$scope.closeModal();$scope.getAllStories()},function errorCallback(err){alert("Failed to connect server(get).");$rootScope.finishLoading('AddingPhoto')})};$scope.init()}]);'use strict';angular.module('chitchat').service('Config',Config);function Config(){this.api={url:"http://localhost/services/xtra_api.php",access_token:"EV^>Ah0:!XtraBoris"}}